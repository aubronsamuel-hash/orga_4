{
  "version": "1.0.0",
  "entity": "orgchart",
  "service": {
    "fields": [
      {"name":"code","type":"string","required":true,"unique":true,"min_length":2,"max_length":30,"pattern":"^[A-Z0-9_-]+$"},
      {"name":"libelle","type":"string","required":true,"min_length":2,"max_length":100}
    ],
    "identifiers":{"primary_key":["code"]}
  },
  "team": {
    "fields": [
      {"name":"code","type":"string","required":true,"unique":true,"min_length":2,"max_length":30,"pattern":"^[A-Z0-9_-]+$"},
      {"name":"libelle","type":"string","required":true,"min_length":2,"max_length":100},
      {"name":"service_code","type":"string","required":true,"relation":"service.code"}
    ],
    "identifiers":{"primary_key":["code"]}
  },
  "hierarchy": {
    "constraints": [
      {"name":"no_self_manager","type":"check","expression":"manager_id IS NULL OR manager_id <> id"},
      {"name":"acyclic_management","type":"graph_rule","description":"No cycles A->...->A in management graph"},
      {"name":"unbounded_children","type":"rule","description":"A manager may have 0..N direct reports"}
    ]
  },
  "relations": [
    {"from":"team.service_code","to":"service.code"},
    {"from":"employee.manager_id","to":"employee.id"}
  ]
}
